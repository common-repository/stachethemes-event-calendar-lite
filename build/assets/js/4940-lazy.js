"use strict";(globalThis.webpackChunkstec=globalThis.webpackChunkstec||[]).push([[4940],{39393:(e,t,a)=>{a.r(t),a.d(t,{InputTextarea:()=>u,UncontrolledInputTextarea:()=>i,default:()=>d});var n=a(8403),l=a(26878),r=a(75761),c=a(78565),s=a(13839),o=a(10382);const i=e=>{const[t,a]=(0,l.useState)(e.defaultValue||""),[i,u]=(0,l.useState)(!1),[d,m]=(0,l.useState)(!1);return(0,l.useEffect)((()=>{if((i||e.wasSubmitted)&&e.regex){const a=new RegExp(e.regex).test(t);m(!1===a)}}),[t,e.regex,e.wasSubmitted,i]),React.createElement(n.StecDiv,{className:"stec-input-textarea-wrapper"},React.createElement("label",null,React.createElement(s.default,{style:{justifyContent:"space-between"}},React.createElement(c.default,{text:e.title})),React.createElement("textarea",{style:e.inputStyle,onBlur:()=>{u(!0)},type:"text",name:e.name,placeholder:e.placeholder,onChange:t=>{a(t.target.value),e.onChange&&e.onChange(t.target.value)},value:t}),React.createElement(o.default,{floating:!0,text:e.errorMessage,display:d}),React.createElement(r.default,{text:e.description})))},u=e=>{const[t,a]=(0,l.useState)(!1),[i,u]=(0,l.useState)(!1);return(0,l.useEffect)((()=>{if((t||e.wasSubmitted)&&e.regex){const t=new RegExp(e.regex).test(e.value);u(!1===t)}}),[e.value,e.regex,e.wasSubmitted,t]),React.createElement(n.StecDiv,{className:"stec-input-textarea-wrapper"},React.createElement("label",null,React.createElement(s.default,{style:{justifyContent:"space-between"}},React.createElement(c.default,{text:e.title})),React.createElement("textarea",{style:e.inputStyle,onBlur:()=>{a(!0)},type:"text",name:e.name,placeholder:e.placeholder,onChange:t=>{e.onChange(t.target.value)},value:e.value}),React.createElement(o.default,{floating:!0,text:e.errorMessage,display:i}),React.createElement(r.default,{text:e.description})))},d=u},15948:(e,t,a)=>{a.r(t),a.d(t,{default:()=>o});var n=a(52779),l=a(73772),r=a(26878),c=a.n(r),s=a(1881);const __=l.__,o=({coordinates:e,onChange:t})=>{const[a,l]=(0,r.useState)(!1);return c().createElement(c().Fragment,null,c().createElement(s.default,{isOpen:a,coordinates:e,onChange:t,onClose:()=>{l(!1)}}),c().createElement(n.default,{className:"blue",label:[c().createElement("i",{key:"icon",className:"fa-solid fa-map-marked-alt"}),__("Find on Map","stachethemes_event_calendar_lite")],onClick:()=>{l(!0)}}))}},97011:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var n=a(32488),l=a(8403),r=a(73772),c=a(26878),s=a.n(c),o=a(60799);const __=r.__,i=({coordinates:e,onCoordinatesChange:t})=>{const[a,r]=(0,c.useState)(!1),[i,u]=(0,c.useState)(""),[d,m]=(0,c.useState)(!1),[h,p]=(0,c.useState)(!1),_=(0,c.useRef)(null);return(0,c.useEffect)((()=>{if(null!==_.current){if(!1===a){_.current.innerHTML="";_.current.appendChild(document.createElement("div")).style.height=_.current.clientHeight+"px";const e=new window.google.maps.Map(_.current,{mapId:`stec-map-${(new Date).getTime()}`,gestureHandling:"greedy",zoom:2,center:{lat:51.505,lng:-.09},streetViewControl:!1,mapTypeControl:!1,fullscreenControl:!1,clickableIcons:!1});r(e)}return()=>{a&&r(!1)}}}),[a]),(0,c.useEffect)((()=>{let e;return e=setTimeout((async()=>{if(i.length>2){p(!0);const e=await(async e=>{const t=`https://nominatim.openstreetmap.org/search?format=json&q=${e}&limit=1`,a=await fetch(t);if(a.ok){const e=await a.json();if(0===e.length)return null;const t=e[0],{lat:n,lon:l}=t;return{lat:n,lon:l}}return null})(i);if(p(!1),e){const{lat:t,lon:n}=e;a&&(a.panTo(new window.google.maps.LatLng(t,n)),a.setZoom(15))}else o.toast.error(__("Location not found","stachethemes_event_calendar_lite"))}}),1e3),()=>{clearTimeout(e)}}),[a,i]),(0,c.useEffect)((()=>{if(!a)return;const t=async()=>await google.maps.importLibrary("marker");!d&&e&&(async()=>{try{const{AdvancedMarkerElement:n}=await t(),l=e.split(","),r=parseFloat(l[0]),c=parseFloat(l[1]),s=new n({position:{lat:r,lng:c},map:a});m(s),a.setCenter({lat:r,lng:c}),a.setZoom(15)}catch(e){}})();return a.addListener("click",(async e=>{d&&d.setMap(null);const{AdvancedMarkerElement:n}=await t(),l=new n({position:e.latLng,map:a});m(l)})),()=>{google.maps.event.clearListeners(a,"click")}}),[a,d,e]),(0,c.useEffect)((()=>{if(a&&d){const e=d.position,{lat:a,lng:n}={lat:e.lat,lng:e.lng};t(`${a},${n}`)}}),[a,d,t]),s().createElement(s().Fragment,null,s().createElement(n.UncontrolledInputText,{placeholder:__("Search Location","stachethemes_event_calendar_lite"),className:"stec-find-on-map-search",value:i,onChange:e=>{u(e)}}),s().createElement(l.StecDiv,{ref:_,style:{opacity:h?.5:1,height:500},className:"stec-find-on-map-container"}))}},1881:(e,t,a)=>{a.r(t),a.d(t,{default:()=>p});var n=a(41426),l=a(21067),r=a(26878),c=a.n(r),s=a(97011),o=a(11773),i=a(88905),u=a(52779),d=a(22819),m=a(8403),h=a(73772);const __=h.__,p=({coordinates:e,onChange:t,isOpen:a,onClose:r})=>{const h=(0,l.useSettingsAtt)("map__type"),p="gmap"===h?s.default:o.default;let _=e;return c().createElement(n.default,{isOpen:a,onClose:r},c().createElement(m.StecDiv,{className:"stec-find-on-map"},c().createElement(i.default,{mapProvider:h},c().createElement(p,{coordinates:e,onCoordinatesChange:e=>{_=e}})),c().createElement(d.default,null),c().createElement(u.default,{className:"green",label:__("Apply","stachethemes_event_calendar_lite"),onClick:()=>{t(_),r()}}),c().createElement(u.default,{className:"red",style:{marginLeft:6},label:__("Cancel","stachethemes_event_calendar_lite"),onClick:r})))}},11773:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var n=a(32488),l=a(8403),r=a(73772),c=a(26878),s=a.n(c),o=a(60799);const __=r.__,i=({coordinates:e,onCoordinatesChange:t})=>{const[a,r]=(0,c.useState)(!1),[i,u]=(0,c.useState)(""),[d,m]=(0,c.useState)(!1),[h,p]=(0,c.useState)(!1),_=(0,c.useRef)(null);return(0,c.useEffect)((()=>{if(null!==_.current){if(!1===a){_.current.innerHTML="";const e=_.current.appendChild(document.createElement("div"));e.style.height=_.current.clientHeight+"px";const t=window.L.map(e,{zoomControl:!1}),a=window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:['&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>','<a href="https://wiki.osmfoundation.org/wiki/Privacy_Policy">Privacy Policy</a>'].join(" | ")});t.addLayer(a),t.setView([51.505,-.09],2),r(t)}return()=>{a&&(a.remove(),r(!1))}}}),[a]),(0,c.useEffect)((()=>{let e;return e=setTimeout((async()=>{if(i.length>2){p(!0);const e=await(async e=>{const t=`https://nominatim.openstreetmap.org/search?format=json&q=${e}&limit=1`,a=await fetch(t);if(a.ok){const e=await a.json();if(0===e.length)return null;const t=e[0],{lat:n,lon:l}=t;return{lat:n,lon:l}}return null})(i);if(p(!1),e){const{lat:t,lon:n}=e;a&&a.setView([t,n],15)}else o.toast.error(__("Location not found","stachethemes_event_calendar_lite"))}}),1e3),()=>{clearTimeout(e)}}),[a,i]),(0,c.useEffect)((()=>{if(!a)return;if(!d&&e)try{const t=e.split(","),n=parseFloat(t[0]),l=parseFloat(t[1]),r=window.L.marker([n,l]).addTo(a);m(r),a.setView([n,l],15)}catch(e){}const t=e=>{d&&d.remove();const t=window.L.marker(e.latlng).addTo(a);m(t)};return a.on("click",t),()=>{a.off("click",t)}}),[a,d,e]),(0,c.useEffect)((()=>{if(a&&d){const{lat:e,lng:a}=d.getLatLng();t(`${e},${a}`)}}),[a,d,t]),s().createElement(s().Fragment,null,s().createElement(n.UncontrolledInputText,{placeholder:__("Search Location","stachethemes_event_calendar_lite"),className:"stec-find-on-map-search",value:i,onChange:e=>{u(e)}}),s().createElement(l.StecDiv,{ref:_,style:{opacity:h?.5:1,height:500},className:"stec-find-on-map-container"}))}},88905:(e,t,a)=>{a.r(t),a.d(t,{default:()=>o});var n=a(21067),l=a(26878),r=a.n(l);const c=({children:e})=>(0,n.useRequestGoogleMapsLib)()?e:null,s=({children:e})=>(0,n.useRequestOpenStreetMapLib)()?e:null,o=({mapProvider:e,children:t})=>"gmap"===e?r().createElement(c,null,t):r().createElement(s,null,t)},54940:(e,t,a)=>{a.r(t),a.d(t,{UpsertForm:()=>T,default:()=>L});var n=a(52779),l=a(93699),r=a(85262),c=a(62552),s=a(32779),o=a(32488),i=a(39393),u=a(48596),d=a(22819),m=a(98196),h=a(91927),p=a(81148),_=a(6405),f=a(13328),g=a(8403),v=a(73772),y=a(26960),E=a(26878),R=a(60799),C=a(15948),w=a(80761);const __=v.__,S=e=>{const{wasSubmitted:t,focusFieldsRef:a,postData:n}=e,{items:l,ready:r,error:c}=(0,f.usePermissions)();return!r||c?null:React.createElement(React.Fragment,null,React.createElement(f.WithMaybeDisplayPermissions,{type:"edit_permission"},React.createElement(d.default,null),React.createElement(s.UncontrolledInputSelect,{ref:e=>a.current.edit_permission=e,multiple:!0,title:__("Edit permission","stachethemes_event_calendar_lite"),options:l.filter((e=>"stec_public"!==e.value)),defaultValue:n.current.meta.edit_permission,description:__("Who can edit this location","stachethemes_event_calendar_lite"),required:!0,errorMessage:__("The edit permission cannot be empty","stachethemes_event_calendar_lite"),wasSubmitted:t,onChange:e=>{n.current.meta.edit_permission=e}})),React.createElement(f.WithMaybeDisplayPermissions,{type:"use_permission"},React.createElement(d.default,null),React.createElement(s.UncontrolledInputSelect,{ref:e=>a.current.use_permission=e,multiple:!0,title:__("Use permission","stachethemes_event_calendar_lite"),options:l,defaultValue:n.current.meta.use_permission,description:__("Who can add this location to their events","stachethemes_event_calendar_lite"),required:!0,errorMessage:__("The use permission cannot be empty","stachethemes_event_calendar_lite"),wasSubmitted:t,onChange:e=>{n.current.meta.use_permission=e}})))},b=React.forwardRef(((e,t)=>{const a=t,[n,l]=(0,E.useState)(0);return React.createElement(React.Fragment,null,React.createElement(o.UncontrolledInputText,{key:n,title:__("Coordinates"),placeholder:__("Lng, Lat","stachethemes_event_calendar_lite"),description:__("Location coordinates in decimal format"),defaultValue:a.current.meta.coordinates,onChange:e=>{a.current.meta.coordinates=e.replace(/\s/gi,"")}}),React.createElement(d.default,null),React.createElement(C.default,{coordinates:a.current.meta.coordinates,onChange:e=>{a.current.meta.coordinates=e,l((0,y.uniqueId)()),R.toast.success(__("Coordinates added","stachethemes_event_calendar_lite"))}}))}));b.displayName="CoordinatesInput";const x=React.forwardRef(((e,t)=>{const a=t,[n,l]=(0,E.useState)(a.current.meta.type||"physical");return React.createElement(React.Fragment,null,React.createElement(s.InputSelect,{multiple:!1,value:n,title:__("Type","stachethemes_event_calendar_lite"),options:[{label:__("Physical location","stachethemes_event_calendar_lite"),value:"physical"},{label:__("Virtual location","stachethemes_event_calendar_lite"),value:"virtual"}],onChange:e=>{l(e),a.current.meta.type=e},description:__("Choose location type","stachethemes_event_calendar_lite")}),React.createElement(d.default,null),"physical"===n&&React.createElement(React.Fragment,null,React.createElement(o.UncontrolledInputText,{defaultValue:a.current.meta.country,title:__("Country","stachethemes_event_calendar_lite"),placeholder:__("Country name","stachethemes_event_calendar_lite"),onChange:e=>{a.current.meta.country=e},description:__("Country","stachethemes_event_calendar_lite")}),React.createElement(d.default,null),React.createElement(o.UncontrolledInputText,{defaultValue:a.current.meta.state,title:__("State/Province","stachethemes_event_calendar_lite"),placeholder:__("State/Province","stachethemes_event_calendar_lite"),onChange:e=>{a.current.meta.state=e},description:__("State or Province if applicable","stachethemes_event_calendar_lite")}),React.createElement(d.default,null),React.createElement(o.UncontrolledInputText,{defaultValue:a.current.meta.city,title:__("City","stachethemes_event_calendar_lite"),placeholder:__("City name","stachethemes_event_calendar_lite"),onChange:e=>{a.current.meta.city=e},description:__("City name if applicable","stachethemes_event_calendar_lite")}),React.createElement(d.default,null),React.createElement(o.UncontrolledInputText,{defaultValue:a.current.meta.postal_code,title:__("Postal code","stachethemes_event_calendar_lite"),placeholder:__("Postal code","stachethemes_event_calendar_lite"),onChange:e=>{a.current.meta.postal_code=e},description:__("Postal code if applicable","stachethemes_event_calendar_lite")}),React.createElement(d.default,null),React.createElement(o.UncontrolledInputText,{defaultValue:a.current.meta.address,title:__("Address","stachethemes_event_calendar_lite"),placeholder:__("Location address","stachethemes_event_calendar_lite"),onChange:e=>{a.current.meta.address=e},description:__("Address","stachethemes_event_calendar_lite")}),React.createElement(d.default,null),React.createElement(b,{ref:a})),"virtual"===n&&React.createElement(React.Fragment,null,React.createElement(o.UncontrolledInputText,{defaultValue:a.current.meta.address,title:__("Address","stachethemes_event_calendar_lite"),placeholder:__("Location address","stachethemes_event_calendar_lite"),onChange:e=>{a.current.meta.address=e},description:__("Virtual location address (https://...)","stachethemes_event_calendar_lite")}),React.createElement(d.default,null),React.createElement(r.UncontrolledInputCheckbox,{title:__("Protected address","stachethemes_event_calendar_lite"),description:__("Only logged-in users can view the address","stachethemes_event_calendar_lite"),defaultValue:a.current.meta.protected,onChange:e=>{a.current.meta.protected=e}})))}));function T(e){const[t,a]=(0,E.useState)(!1),[r,s]=(0,E.useState)(0),h=(0,E.useRef)(!1),f=w.default,g=(0,E.useRef)((0,y.cloneDeep)(e.template?e.template:f)),v=(0,E.useRef)([]),C=(e,t=!0)=>{g.current=t?(0,y.cloneDeep)(e):e,s((0,y.uniqueId)())},b=g.current.id?[React.createElement("i",{key:"icon",className:"fa-solid fa-pen-to-square"}),__("Edit location","stachethemes_event_calendar_lite")]:[React.createElement("i",{key:"icon",className:"fa-solid fa-plus"}),__("Add new location","stachethemes_event_calendar_lite")];return React.createElement(u.default,{title:b,key:r},React.createElement(p.default,{postData:g}),React.createElement(o.UncontrolledInputText,{ref:e=>v.current.name=e,title:__("Name"),defaultValue:g.current.name,placeholder:__("Location name","stachethemes_event_calendar_lite"),description:__("Location name"),required:!0,regex:(0,_.getRegexByType)("title"),errorMessage:__("The location must have a name","stachethemes_event_calendar_lite"),wasSubmitted:t,onChange:e=>{g.current.name=e}}),React.createElement(d.default,null),React.createElement(o.UncontrolledInputText,{ref:e=>v.current.slug=e,title:__("Slug"),defaultValue:g.current.slug,placeholder:__("Location slug","stachethemes_event_calendar_lite"),description:__("Leave empty to auto-generate"),required:!1,regex:(0,_.getRegexByType)("slug"),errorMessage:__("The location must have a valid slug","stachethemes_event_calendar_lite"),onChange:e=>{g.current.slug=e},wasSubmitted:t}),React.createElement(d.default,null),React.createElement(c.UncontrolledInputColor,{title:__("Color","stachethemes_event_calendar_lite"),defaultValue:g.current.meta.color,description:__("Location color","stachethemes_event_calendar_lite"),onChange:e=>{g.current.meta.color=e}}),React.createElement(d.default,null),React.createElement(i.UncontrolledInputTextarea,{title:__("Description","stachethemes_event_calendar_lite"),description:__("About this location","stachethemes_event_calendar_lite"),defaultValue:g.current.description,onChange:e=>{g.current.description=e}}),React.createElement(d.default,null),React.createElement(x,{ref:g,wasSubmitted:t}),React.createElement(d.default,null),React.createElement(S,{postData:g,focusFieldsRef:v,wasSubmitted:t}),React.createElement(d.default,null),React.createElement(n.default,{label:g.current.id?__("Update","stachethemes_event_calendar_lite"):__("Create","stachethemes_event_calendar_lite",0),className:"green",onClick:()=>{if(!0!==h.current){if(a(!0),!1===(()=>{const e=[{id:"name",regex:(0,_.getRegexByType)("title"),meta:!1,errorMessage:__("The location must have a name","stachethemes_event_calendar_lite")},{id:"slug",regex:(0,_.getRegexByType)("slug"),meta:!1,errorMessage:__("The location must have a valid slug","stachethemes_event_calendar_lite")},{id:"use_permission",meta:!0,errorMessage:__("The use permission cannot be empty","stachethemes_event_calendar_lite")},{id:"edit_permission",meta:!0,errorMessage:__("The edit permission cannot be empty","stachethemes_event_calendar_lite")},{id:"coordinates",regex:(0,_.getRegexByType)("coordinates"),meta:!0,errorMessage:__("The location must have valid coordinates","stachethemes_event_calendar_lite"),condition:"physical"}];for(let t in e){const a=e[t],n=a.meta?g.current.meta[a.id]:g.current[a.id];if(a.condition&&"physical"===a.condition&&"physical"!==g.current.meta.type)continue;let l=!0;if(l=a.regex?new RegExp(a.regex).test(n):Array.isArray(n)?n.length>0:!(!n||""===n),!1===l)return v.current[a.id]&&v.current[a.id].focus(),R.toast.error(a.errorMessage),!1}return!0})())return!1;R.toast.promise(new Promise(((t,a)=>{h.current=!0,async function(){try{let n;n=g.current.id?await(0,m.newApiPut)({route:"LOCATIONS",args:g.current.id,data:g.current,includeResponseStatus:!0,errorMessage:"auto"}):await(0,m.newApiPost)({route:"LOCATIONS",data:g.current,includeResponseStatus:!0,translateErrorCode:{term_exists:__("A location with this name already exists","stachethemes_event_calendar_lite")},errorMessage:"auto"});const{status:l,data:r}=n;switch(l){case 201:return e.onLocationInserted&&e.onLocationInserted(r),C(r),(0,m.flushApiCache)({group:"taxonomy-stec_loc"}),t(__("Created","stachethemes_event_calendar_lite"));case 200:return C(r),e.onLocationInserted&&e.onLocationInserted(r),(0,m.flushApiCache)({group:"taxonomy-stec_loc"}),t(__("Updated","stachethemes_event_calendar_lite"));default:return a(__("Sorry, something went wrong","stachethemes_event_calendar_lite"))}}catch(e){return a(e.message)}}()})),{loading:__("Saving","stachethemes_event_calendar_lite"),success:e=>(h.current=!1,e),error:e=>(h.current=!1,e)})}else(0,R.toast)(__("Another action is in progress","stachethemes_event_calendar_lite"))}}),React.createElement(n.default,{label:__("Reset form","stachethemes_event_calendar_lite"),className:"yellow",style:{marginLeft:5},onClick:()=>{C(f),a(!1),(0,R.toast)(__("The form has been reset","stachethemes_event_calendar_lite"))}}),g.current.id&&React.createElement(l.default,{label:__("Delete","stachethemes_event_calendar_lite"),className:"red",style:{marginLeft:5},onClick:()=>{!0!==h.current?R.toast.promise(new Promise(((t,a)=>{h.current=!0,async function(){try{await(0,m.newApiDelete)({route:"LOCATIONS",args:g.current.id});e.onLocationDeleted&&e.onLocationDeleted(g.current);const a=(0,y.cloneDeep)(g.current);return a.id="",C(a,!1),(0,m.flushApiCache)({group:"taxonomy-stec_loc"}),t(__("Deleted","stachethemes_event_calendar_lite"))}catch(e){return a(e.message)}}()})),{loading:__("Deleting","stachethemes_event_calendar_lite"),success:e=>(h.current=!1,e),error:e=>(h.current=!1,e)}):(0,R.toast)(__("Another action is in progress","stachethemes_event_calendar_lite"))}}),React.createElement(n.default,{label:__("Back","stachethemes_event_calendar_lite"),className:"blue",style:{marginLeft:5},onClick:()=>{const t=!g.current.id;e.onBack(t)}}))}x.displayName="LocationTypeSpecificForm";const L=function(){const{setActiveMenu:e,activeMenuParams:t}=(0,h.useDashboardMenu)(),a=a=>{let n=t.manageListQueryArgs||null;a&&(n=null),e({page:"locations-list",params:{initialQueryArgs:n}})};return React.createElement(React.Fragment,null,React.createElement(g.StecDiv,{className:"stec-dashboard-top-nav"},React.createElement(n.default,{className:"stcolor stec-dashboard-home-button",label:[React.createElement("i",{key:"icon",className:"fa-solid fa-home"}),__("Home","stachethemes_event_calendar_lite")],onClick:()=>{e({page:"home",params:{}})}}),React.createElement(n.default,{className:"blue",label:[React.createElement("i",{key:"icon",className:"fa-solid fa-list"}),__("Manage locations","stachethemes_event_calendar_lite")],onClick:a})),React.createElement(T,{template:t.template||!1,onBack:e=>{a(e)}}))}},80761:(e,t,a)=>{a.r(t),a.d(t,{default:()=>n});const n=void 0!==window.STEC_LOCATION_TEMPLATE?window.STEC_LOCATION_TEMPLATE:{name:"",slug:"",status:"publish",description:"",meta:{author:"",color:"#FFE59D",type:"physical",coordinates:"",country:"",state:"",city:"",address:"",postal_code:"",read_permission:["stec_public"],use_permission:["stec_private"],edit_permission:["stec_private"],protected:!1}}}}]);